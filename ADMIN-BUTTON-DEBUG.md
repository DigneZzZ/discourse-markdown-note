# Диагностика проблемы с кнопкой "Обновить Discourse"

## Проблема
При включенном плагине discourse-markdown-note пропадает кнопка "Обновить Discourse" из админки `/admin/update`.

## Возможные причины

### 1. CSS конфликты
- CSS правила плагина могут скрывать или изменять стили админки
- Глобальные селекторы могут затрагивать элементы вне области заметок

### 2. JavaScript конфликты
- Инициализация плагина может запускаться на админских страницах
- CSS классы могут применяться к элементам админки

## Исправления, примененные в версии 0.8.3

### JavaScript изменения:
1. **Расширенная проверка админских роутов:**
   - Проверка `window.location.pathname.startsWith('/admin')`
   - Проверка наличия классов `admin-interface`
   - Попытка детекции admin контроллера

2. **Дополнительные проверки в функции applyNoteStyles:**
   - Повторная проверка админского контекста перед применением стилей
   - Пропуск применения CSS классов в админке

### CSS изменения:
1. **Полное исключение админки:**
   - Селекторы обернуты в `body:not(.admin-interface):not([class*="admin"])`
   - Ограничение области действия только контентными областями

2. **Специфичные селекторы:**
   - Все стили ограничены областями: `#main-outlet`, `.topic-body`, `.post-stream`, `.cooked`
   - Полностью исключена возможность влияния на админку

## Как проверить исправление

### 1. Проверка в консоли браузера
На странице `/admin/update` должны появиться логи:
```
[Markdown Notes] Skipping initialization on admin route: /admin/update
```

### 2. Проверка CSS классов
В админке на элементе `<body>` НЕ должно быть классов:
- `hide-note-icons`
- `hide-note-titles`

### 3. Проверка элементов
Кнопка "Обновить Discourse" должна быть видна и кликабельна.

## Временное решение (если проблема остается)

### Отключить плагин через SSH:
```bash
cd /var/discourse
./launcher enter app
rails c
SiteSetting.discourse_markdown_note_enabled = false
exit
```

### Или через базу данных:
```sql
UPDATE site_settings SET value = 'f' WHERE name = 'discourse_markdown_note_enabled';
```

## Отладочная информация

### Собрать логи:
1. Откройте консоль разработчика (F12)
2. Перейдите на `/admin/update`
3. Скопируйте все сообщения, начинающиеся с `[Markdown Notes]`
4. Проверьте наличие ошибок JavaScript

### Проверить CSS:
1. Откройте инспектор элементов на кнопке "Обновить Discourse"
2. Найдите стили, которые могут скрывать кнопку
3. Поищите стили с `display: none` или `visibility: hidden`

## Контакты для поддержки
Если проблема не решена, предоставьте:
- Версию Discourse
- Логи из консоли браузера
- Скриншот инспектора элементов кнопки
